"use strict";angular.module("bulbs.slideshow.edit",[]).directive("slideshowEdit",[function(){return{restrict:"E",templateUrl:"bulbs-cms/slideshow-edit/slideshow-edit.html",scope:{article:"="},controller:["$scope","$window","$timeout",function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++)a[c][b]=c}a.isEditing=!1,a.selectedPage=null,a.$watch("article",function(b,c){a.selectedPage&&(a.selectedPage=_.find(pages,function(b){return b.order==a.selectedPage.order}))}),a.selectPage=function(d){a.selectedPage=d,a.isEditing=!!d,a.isEditing&&c(function(){b.picturefill($(".slideshow-page")[0])})},a.onAddPage=function(){var b={name:"",body:"",order:a.article.slides.length};a.article.slides.push(b),d(a.article.slides,"order"),a.selectPage(b)},a.onDeletePage=function(b,c){var e=b.indexOf(c);e>=0&&(b.splice(e,1),d(b,"order"),a.selectedPage&&c.order==a.selectedPage.order&&a.selectPage(null))},a.onClonePage=function(b){a.onAddPage();var c=a.selectedPage;angular.copy(b,c),c.title="Clone "+c.title},a.onDeleteObject=function(a,b){var c=a.indexOf(b);c>=0&&(a.splice(c,1),d(a,"order"))},a.onMoveListObject=function(a,b,c){if(b>=0&&c>=0&&c<a.length){var e=a[b];a.splice(b,1),a.splice(c,0,e),d(a,"order")}},0===a.article.slides.length&&a.onAddPage(),d(a.article.slides,"order")}]}}]),angular.module("bulbsCmsApp").controller("SlideshowEditCtrl",function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++)a[c][b]=c}a.isEditing=!1,a.selectedPage=null,a.$watch("article",function(b,c){a.selectedPage&&(a.selectedPage=_.find(pages,function(b){return b.order==a.selectedPage.order}))}),a.selectPage=function(d){a.selectedPage=d,a.isEditing=!!d,a.isEditing&&c(function(){b.picturefill($(".slideshow-page")[0])})},a.onAddPage=function(){var b={name:"",body:"",order:a.article.slides.length};a.article.slides.push(b),d(a.article.slides,"order"),a.selectPage(b)},a.onDeletePage=function(b,c){var e=b.indexOf(c);e>=0&&(b.splice(e,1),d(b,"order"),a.selectedPage&&c.order==a.selectedPage.order&&a.selectPage(null))},a.onClonePage=function(b){a.onAddPage();var c=a.selectedPage;angular.copy(b,c),c.title="Clone "+c.title},a.onDeleteObject=function(a,b){var c=a.indexOf(b);c>=0&&(a.splice(c,1),d(a,"order"))},a.onMoveListObject=function(a,b,c){if(b>=0&&c>=0&&c<a.length){var e=a[b];a.splice(b,1),a.splice(c,0,e),d(a,"order")}},0===article.slides.length&&a.onAddPage(),d(a.article.slides,"order")}).directive("slideshowPane",function(a,b,c,d,e){return{restrict:"E",templateUrl:e.PARTIALS_URL+"slideshow-pane.html",scope:{article:"=",image:"=",index:"="},link:function(a,c,f){var g=d(c);"false"===f.caption&&(a.hideCaption=!0),a.format=f.format||"jpg",a.crop=f.crop||"16x9",a.removeImage=function(b){a.article.slides.splice(b,1)},a.editImage=function(c){b.openImageDrawer(a.article.slides[c].id,function(d){function f(){g.find('.image img[src="'+e.LOADING_IMG_SRC+'"]').remove()}f(),g.find(".image").data("imageId")!==d.id&&(g.find(".image img").on("load",f),g.find(".image img").after('<img src="'+e.LOADING_IMG_SRC+'">'),a.article.slides[c].id=d.id.toString(),a.$apply(),b.picturefill(),g.find(".image img")[0].complete&&f())},function(){},function(d){a.article.slides[c]=d,b.picturefill()})}}}}),angular.module("bulbs.slideshow",["bulbs.slideshow.edit","bulbs.slideshow.templates"]),angular.module("bulbs.slideshow.templates",[]).run(["$templateCache",function(a){a.put("bulbs-cms/slideshow-edit/slideshow-edit.html",'<div class="slideshow row"><div class=col-xs-4><div class="navbar row"><div class=navbar-brand>Pages</div><div class="navbar-form btn-group pull-right"><button class="btn btn-default btn-sm" ng-click=onAddPage()><span class="glyphicon glyphicon-plus"></span> Page</button></div></div><ul class=list-group><li class="list-group-item clearfix" ng-repeat="page in article.slides" ng-class="{active:selectedPage && selectedPage.order == page.order }" ng-click=selectPage(page)><div class="btn-group btn-group-vertical pull-right"><button class="btn btn-link btn-xs" ng-click="onDeletePage(article.slides, page)"><span class="glyphicon glyphicon-remove"></span></button> <button class="btn btn-link btn-xs" ng-click="onMoveListObject(article.slides, $index, $index - 1)" ng-disabled="$index == 0"><span class="glyphicon glyphicon-chevron-up"></span></button> <button class="btn btn-link btn-xs" ng-click="onMoveListObject(article.slides, $index, $index + 1)" ng-disabled=$last><span class="glyphicon glyphicon-chevron-down"></span></button></div><span ng-show=!!page.name ng-bind-html=page.name></span> <span ng-show=!page.name>Page {{ $index + 1}}</span></li></ul></div><div class=col-xs-8><div ng-show=!isEditing><h3><span class="fa fa-arrow-left"></span> Create or select a page</h3></div><div ng-show=isEditing><slideshow-page pages=article.slides page=selectedPage select-page=selectPage(selectedPage)></slideshow-page></div></div></div>')}]);